<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Основы геоинформационных систем в QGIS - 4&nbsp; Cоздание тематических карт</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter5_queries.html" rel="next">
<link href="./chapter3_attributes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Поиск не дал результатов",
    "search-matching-documents-text": "Результаты поиска",
    "search-copy-link-title": "Скопировать ссылку",
    "search-hide-matches-text": "Скрыть дополнительные результаты",
    "search-more-match-text": "дополнительный результат в этом документе",
    "search-more-matches-text": "дополнительных результата(-ов) в этом документе",
    "search-clear-button-title": "Очистить",
    "search-detached-cancel-button-title": "Отменить",
    "search-submit-button-title": "Найти"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="././cover.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Основы геоинформационных систем в QGIS</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Поиск"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter4_thematic_maps.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cоздание тематических карт</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключить боковую панель навигации" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Поиск" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Поиск"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Введение</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter0_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Дополнительные ресурсы</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter1_georeferencing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Привязка растра</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter2_vectorization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Векторизация</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3_attributes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Добавление атрибутивной информации</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter4_thematic_maps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cоздание тематических карт</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter5_queries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Поиск объектов по атрибутивной информации и пространственному положению</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter6_spatial_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Пространственные операции с векторными объектами.</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./application_1_geopackage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Приложение. Файлы GeoPackage</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter7_DEM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Цифровая модель рельефа.</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Библиографический список</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Содержание</h2>
   
  <ul>
  <li><a href="#система-координат-проекта" id="toc-система-координат-проекта" class="nav-link active" data-scroll-target="#система-координат-проекта"><span class="header-section-number">4.1</span> Система координат проекта</a></li>
  <li><a href="#sec-simple_labels" id="toc-sec-simple_labels" class="nav-link" data-scroll-target="#sec-simple_labels"><span class="header-section-number">4.2</span> Обычные подписи</a></li>
  <li><a href="#sec-labels_by_rules" id="toc-sec-labels_by_rules" class="nav-link" data-scroll-target="#sec-labels_by_rules"><span class="header-section-number">4.3</span> Подписи на основе правил</a></li>
  <li><a href="#настройки-стиля-объектов" id="toc-настройки-стиля-объектов" class="nav-link" data-scroll-target="#настройки-стиля-объектов"><span class="header-section-number">4.4</span> Настройки стиля объектов</a></li>
  <li><a href="#простая-символика" id="toc-простая-символика" class="nav-link" data-scroll-target="#простая-символика"><span class="header-section-number">4.5</span> Простая символика</a>
  <ul class="collapse">
  <li><a href="#простая-заливка" id="toc-простая-заливка" class="nav-link" data-scroll-target="#простая-заливка"><span class="header-section-number">4.5.1</span> Простая заливка</a></li>
  </ul></li>
  <li><a href="#символизация-по-уникальным-значениям" id="toc-символизация-по-уникальным-значениям" class="nav-link" data-scroll-target="#символизация-по-уникальным-значениям"><span class="header-section-number">4.6</span> Символизация по уникальным значениям</a></li>
  <li><a href="#символизация-по-диапазонам-значений" id="toc-символизация-по-диапазонам-значений" class="nav-link" data-scroll-target="#символизация-по-диапазонам-значений"><span class="header-section-number">4.7</span> Символизация по диапазонам значений</a></li>
  <li><a href="#sec-rules" id="toc-sec-rules" class="nav-link" data-scroll-target="#sec-rules"><span class="header-section-number">4.8</span> Cимволизация на основе правил</a></li>
  <li><a href="#создание-и-заполнение-макета" id="toc-создание-и-заполнение-макета" class="nav-link" data-scroll-target="#создание-и-заполнение-макета"><span class="header-section-number">4.9</span> Создание и заполнение макета</a></li>
  <li><a href="#добавление-легенды" id="toc-добавление-легенды" class="nav-link" data-scroll-target="#добавление-легенды"><span class="header-section-number">4.10</span> Добавление легенды</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Cоздание тематических карт</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Уведомление
</div>
</div>
<div class="callout-body-container callout-body">
<p>Для выполнения заданий из этого раздела загрузите файлы по <a href="https://github.com/agoroshko/qgis_for_beginners/tree/main/files/%D1%81h4_C%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%82%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D1%85%20%D0%BA%D0%B0%D1%80%D1%82">ссылке</a></p>
</div>
</div>
<p>Важной частью географических информационных систем является возможность визуализации информации. Графический анализ позволяет устранить ошибки данных или выявить закономерности. Раздел посвящен возможностям визуализации в программе QGIS. Для выполнения заданий из этого раздела загрузите необходимые файлы. Обратите внимание, загруженные файлы сохранены в формате .gpkg (GeoPackage). Особенности этого формата рассмотрены в приложении (<a href="application_1_geopackage.html"><span>Глава&nbsp;7</span></a>).<br>
Исходные данные представлены четырьмя слоями, которые содержат информацию о части Караульного лесничества: kvartala.gpkg - границы кварталов; videla.gpkg - границы лесных выделов с таксационными характеристиками; roads.gpkg - дороги; rivers.gpkg - реки. Перечисленные слои будут использоваться для создания тематических карт.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Создайте новую папку проекта а так же новый проект в QGIS и загрузите файлы в программу. Сохраните проект в папку проекта.</p>
</div>
</div>
<section id="система-координат-проекта" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="система-координат-проекта"><span class="header-section-number">4.1</span> Система координат проекта</h2>
<p>Системы координат подразделяются на географические и спроецированные (местные системы координат не рассматриваются в этом пособии). Геогрифические системы рассматривают землю как объемную фигуру (эллипсоид), спроецированные делят поврехность зелмли на равные части (зоны) и рассматривают каждую зону как проекцию на плоскость. Как следствие, различаются единицы измерения координат. Положение точки в географической системе координат определеяется в угловой мере (градусы, минуты и секунды) по широте и долготе. В спроецированной системе координат положение точки определяется на плоскости (декардова система координат) и выражается в километрах по оси Х и У. Среди географических систем координат наиболее распространена <strong>WGS 84 (EPSG:4326)</strong>, на основе которой построена спроецированная система координат <strong>UTM (EPSG:32xxx)</strong>. Система координат UTM делит поверхность земли по экватору на 60 зон а так же на северное и южное полушарие. Например, система координат <strong>WGS 84 / UTM zone 46N (EPSG:32646)</strong> представляет 46 зону северного полушария (буква N в названии зоны указывает на полушарие). Для интернет-карт повсеместно распространено использование системы <strong>WGS 84 / Pseudo-Mercator (EPSG:3857)</strong> которая так же называется Web Mercator, которая была разработана компаний Google и является одновременно географической (для мелкого масштаба) и спроецированной (для крупного масштаба).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Обратите внимание!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Систему координат <strong>WGS 84 / Pseudo-Mercator (EPSG:3857)</strong> удобно сипользовать в качестве системы координат проекта, но не следует создавать слои в этой системе координат. Для этих целей используйте WGS 84 или UTM.</p>
</div>
</div>
<p>В программе QGIS реализовано перепроецирование “на лету” (on fly). Векторные слои могут иметь различные системы координат, но в основном окне программы они отображаются согласованно - в одной и той же <strong>системе координат проекта</strong>. Для изменения системы координат проекта выберите <strong>“Проект” &gt; “Свойства” &gt; “СК”</strong> или нажмите на символ в правом нижнем углу <img src="./icons/13_СК.png" class="img-fluid" alt="СК">. После чего появится окно с настройками системы координат <a href="#fig-proj_crs">Рисунок&nbsp;<span>4.1</span></a>.</p>
<div id="fig-proj_crs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/18_Система координат проекта.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.1: Настройка системы координат проекта</figcaption>
</figure>
</div>
<p>У каждой системы координат существует уникальный номер <strong>EPSG</strong>, который удобно использовать для поиска. Изображение в правом нижнем углу окна показывает область применения системы координат на поверхности земли. Текущее положение основного окна карты отображено перекрестием а область применения - красной заливкой, что особенно удобно при выборе нужной зоны спроецированной системы координат. После выбора нужной системы координат проекта нажмите <strong>“Применить” &gt; “ОК”</strong>, изображение в главном окне программы изменится согласно выбранной системе координат.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.2
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Какая зона UTM подходит вашему проекту? Выберите подходящую систему координат из следующих:</li>
</ol>
<ul>
<li>WGS 84 / UTM zone 45N (EPSG:32645);</li>
<li>WGS 84 / UTM zone 46N (EPSG:32646);</li>
<li>WGS 84 / UTM zone 46S (EPSG:32746).</li>
</ul>
<ol start="2" type="1">
<li>Задайте систему координат проекта WGS 84 / Pseudo-Mercator (EPSG:3857).</li>
</ol>
</div>
</div>
<p>Координаты положения курсора отображаются посередине в нижней части главного окна программы, рядом с текущим масштабом. Формат отображаемых координат настраивается в меню <strong>“Проект” &gt; “Свойства…” &gt; “Общие” &gt; “Отображение координат…”</strong>. Географические координаты могут быть отображены в десятичных градусах, градусах и минутах или градусах, минутах и секундах (пункт “Coordinate format”). Так же настраиваются единицы измерения: метры или градусы (degrees) и точность координат.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Измените формат отображаемых координат в нижней части экрана. Формат отображения координат должен быть следующим: <img src="./icons/14_координаты.png" class="img-fluid" alt="Координаты"></p>
</div>
</div>
</section>
<section id="sec-simple_labels" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-simple_labels"><span class="header-section-number">4.2</span> Обычные подписи</h2>
<p>Подписи объектов существенно увеличивают информативность карты. Они настраиваются отдельно для каждого слоя в меню <strong>“Свойства…” &gt; “Надписи”</strong>. Существует несколько режимов отображения подписей: <strong>“Без подписей”, “Обычные подписи”, “Подписи на основе правил”, “Препятствие для подписей”</strong>. В этом и слдующем подразделах будут рассмотрены “Обычные подписи” и “Подписи на основе правил”. Рассмотрим подписи объектов на примере слоя “kvartala” (проект с этим слоем был создан в начале раздела). При настройке “Обычных подписей” основным параметром является <strong>“Значение”</strong>, которым будет подписан каждый объект в этом слое. Слой лесных кварталов содержит поле “kvartal” в котором записан номер квартала для каждого объекта. В этом не сложно убедиться, если открыть таблицу атрибутов слоя. Именно это поле указывается в пункте <strong>“Значение”</strong>. Таким образом каждый квартал получает подпись из соответствующего поля атрибутивной таблицы - номер квартала <a href="#fig-labels">Рисунок&nbsp;<span>4.2</span></a>.</p>
<div id="fig-labels" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./gif/23_Подписи.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.2: Подписи слоя “kvartala”</figcaption>
</figure>
</div>
<p>Остальные настройки не влияют на содержание подписей, только на их оформление. Внесенные изменения сразу отображаются в верхней части окна под названием “Образец текста”. Пункт “Текст” позволяет настроить шрифт, размер и цвет текста. “Форматирование” настраивает регистр, отступы, перенос подписей по строкам, форматы чисел. Крайне полезными настройками является “Буферизация” и “Фон”, позволяющие строить буфер (по умолчанию белого цвета) вокруг подписей, так повышается их видимость на фоне других объектов. Пункт “Размещение” настраивает положение подписей относительно объекта. Чаще всего подписи размещают на некотором расстоянии от точечных объектов или внутри полигонов. “Отрисовка” позволяет задать масштаб карты для отображения подписей. При большом количестве подписей они могут накладываться друг на друга. В этом случае по умолчанию часть подписей не будет видна, что бы изменить это поведение перейдите в пунк <strong>“Настройки размещения подписей”</strong> в правом верхнем углу окна и поставьте чек-бокс “Показывать все подписи для всех слоев (включая наложения)” <a href="#fig-labels2">Рисунок&nbsp;<span>4.3</span></a>.</p>
<div id="fig-labels2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./gif/24_наложение подписей.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.3: Наложение подписей</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Измените подписи слоя “kvartala”. Установите шрифт - Liberation Sans, размер - 20, цвет текста - зеленый, буфер вокруг подписей - белый.</p>
</div>
</div>
<p>В некоторых случаях требуется отобразить подписи сразу из нескольких полей, например номер выдела и площадь. Настроить такую подпись возможно в редакторе выражений <img src="./icons/11_Редактор выражений расширенный.png" class="img-fluid" alt="Редактор выражений"> (левый верхний угол окна). Создадим подписи объектов слоя “videla” из полей “videl” (номер выдела) и “s_ga” (площадь в гектарах) разделенных тире. Перейдите в окно “Редактор выражений” в центральной части в пункте “Поля и значения” найдите поля “videl” и “s_ga”. После двойного клика они будут перенесены в левую часть окна, где и формируется выражение. Разделите их символом “Сцепление строк” <img src="./icons/15_сцепление строк.png" class="img-fluid" alt="Сцепление строк"> что бы получилось следующее выражение: <strong>“videl” || ’ - ’ || “s_ga”</strong> (<a href="#fig-concatenate">Рисунок&nbsp;<span>4.4</span></a>). Результатом выражения отображается в нижнем левом угул окна, пункт “Просмотр:”. Если в этом пункте отображается надпись “Ошибочное выражение” следует исправить выражение.</p>
<div id="fig-concatenate" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/19_Объединение полей.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.4: Создание подписи из нескольких полей</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.5
</div>
</div>
<div class="callout-body-container callout-body">
<p>Создайте подписи слоя “videla” из полей “videl” и “el_lesa” (преобладающая порода) по примеру выше.</p>
</div>
</div>
</section>
<section id="sec-labels_by_rules" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-labels_by_rules"><span class="header-section-number">4.3</span> Подписи на основе правил</h2>
<p>Использование режима “Обычные подписи” удобно, когда все объекты слоя должны быть подписаны одинаково. Если же часть объектов должна остаться без подписей или подписи должны изменяться по условию - применяют режим “Подписи на основе правил”. Рассмотрим работу с этим режимом на примере слоя “videla” который содержит границы выделов и таксационную характеристику каждого из них. Основной настройкой здесь является задание логического правила, согласно которому будут отобраны объекты. Перейдите в режим “Подписи на основе правил” и добавьте новое правило нажав на символ <img src="./icons/12_добавить новую связь.png" class="img-fluid" alt="Добавить правило">. В верхней части окна “Edit Rule” задается правило, в нижней - настраивается подпись. Рассмотрим врхнюю часть окна, поскольку настройка подписи была рассмотрена выше (<a href="#sec-simple_labels"><span>Глава&nbsp;4.2</span></a>).<br>
В пункте “Описание” вводится название правила. У каждого правила может быть два режима “Поиск” и “Иначе для всех остальных объектов”. Второй пункт используется, когда создано несколько правил и требуется добавить подписи для всех остальных объектов. Для создания правила используется окно “Конструктор выражений” <img src="./icons/11_Редактор выражений расширенный.png" class="img-fluid" alt="Конструктор выражений">. Логические условия задаются на основе атрибутов объектов. Для примера составим выражение в котором будут подписаны лесные выдела с площадью более 4 га: <code>"s_ga" &gt; 4</code>. Функция “Проверка” позволяет узнать количество объектов, попадающих под это условие <a href="#fig-labels_rules">Рисунок&nbsp;<span>4.5</span></a>. Более подробно создание логических выражений будет рассмотрено в <a href="chapter5_queries.html"><span>Глава&nbsp;5</span></a>.</p>
<div id="fig-labels_rules" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./gif/25_подписи на основе правил.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.5: Создание подписей на основе правил</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.6
</div>
</div>
<div class="callout-body-container callout-body">
<p>Создайте подписи слоя “videla”. Добавьте номер выдела только для тех выделов, в которых средний возраст насаждения более 100 лет (средний возраст - поле “A_let”).</p>
</div>
</div>
</section>
<section id="настройки-стиля-объектов" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="настройки-стиля-объектов"><span class="header-section-number">4.4</span> Настройки стиля объектов</h2>
<p>Одним из ключевых имнструментов визуализиции пространственных данных является раскраска объектов цветом. Все объекты слоя могут быть окрашены одинаково или, в зависимости от значений атрибутов, иметь разные цвета. В программе QGIS настройка стиля отображения объектов производится в контекстном меню панели слоев <strong>“Свойства…” &gt; “Стиль”</strong>. Существует несколько режимов отображения объектов: <strong>“Без отрисовки”</strong> объекты будут не видны но надписи объектов будут отображаться; <strong>“Простая символика”</strong> задает единый стиль для всех объектов слоя; “Символизация по уникальным значениям” позволяет задать стиль отображения в зависимости от значений качественного атрибута (преобладающая порода, класс бонитета и т.д.); <strong>“Символизация по диапазонам значений”</strong> задает стиль в зависимости от количественного атрибута (средний возраст насаждения, средний диаметр, запас и т.д.). <strong>“Символизация на основе правил”</strong> позволяет задать гибкие правила для отображения стиля объектов по нескольким атрибутам. Настройка символики несколько видоизменяется в зависимости от типа геометрии слоя. Для точек будет задаваться стиль маркера, для линий - стиль линии, для полигонов - стиль заливки. Особенности геометрий объектов отражаются на особенностях их отображения. Упомянутые выше режимы отображения объектов рассмотрены далее на примере полигонального слоя “videla” из созданного ранее проекта.</p>
</section>
<section id="простая-символика" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="простая-символика"><span class="header-section-number">4.5</span> Простая символика</h2>
<p>В режиме “Простая символика” все объекты отображаются в одном стиле, который может быть простым (состоит из одного слоя) так и сложным (состоящим из двух и более слоев). По умолчанию единственным слоем является “Простая заливка”. Комбинируя несколько простых слоев возможно создать сложный стиль отображения.</p>
<section id="простая-заливка" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="простая-заливка"><span class="header-section-number">4.5.1</span> Простая заливка</h3>
<div id="fig-simple_fill" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/20_Простая заливка.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.6: Простая заливка</figcaption>
</figure>
</div>
<p>Тип слоя “Простая заливка” (<a href="#fig-simple_fill">Рисунок&nbsp;<span>4.6</span></a>) позволяет настоить основных два цвета: “Цвет заливки” и “Цвет обводки”. Стиль заливки может быть сплошной, без заливки или разными видами штриховки. Для обводки объектов настраивается толщина и стиль (сплошная, без обводки и штриховка).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.7
</div>
</div>
<div class="callout-body-container callout-body">
<p>Измените “Цвет заливки” и “Цвет обводки” слоя “videla” по вашему усмотрению.</p>
</div>
</div>
<p>Комбинируя несколько слоев создаются сложные заливки. Для этого добавьте еще один слой нажав на символ <img src="./icons/12_добавить новую связь.png" class="img-fluid" alt="Добавить слой"> в правом верхнем углу. Верхний слой будет перекрывать нижний, поэтому он должен быть полупрозрачным или залит штриховкой. После настройки изображение в квадрате слева изменится, в соответствии с новым стилем штриховки <a href="#fig-two_layers">Рисунок&nbsp;<span>4.7</span></a>.</p>
<div id="fig-two_layers" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./gif/26_два_слоя.gif" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.7: Комбинирование двух слоев заливки</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.8
</div>
</div>
<div class="callout-body-container callout-body">
<p>Объедините два слоя заливки по примеру выше. Настройки выберите самостоятельно.</p>
</div>
</div>
<p>Аналогичным образом применяются и комбинируются другие типы слоев.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.9
</div>
</div>
<div class="callout-body-container callout-body">
<p>Выберите любой тип слоя кроме “Простая заливка”, настройте его по своему усмотрению и оцените результат.</p>
</div>
</div>
</section>
</section>
<section id="символизация-по-уникальным-значениям" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="символизация-по-уникальным-значениям"><span class="header-section-number">4.6</span> Символизация по уникальным значениям</h2>
<p>Признаки (характеристики) объектов подразделяются на два больших класса: <strong>количественные и качественные</strong>. Количественные признаки это числовые измерения характеристик объекта (например средний возраст, средняя высота, средний диаметр древостоя), качественные - принадлежность к той или иной категории (преобладающая порода, тип леса, класс бонитета).<br>
Для отображения <strong>качественных</strong> признаков используется <strong>символизация по уникальным значениям</strong>, при этом каждому уникальному значению задается определенный стиль. Для примера раскрасим слой выделов по преобладающей породе (поле “el_lesa”). Перейдите в пункт <strong>“Свойства слоя” &gt; “Стиль” &gt; “Символизация по уникальным значениям”</strong>, в пункте “Значение” указывается поле для классификации (“el_lesa”). После нажатия “Классифицировать” каждому уникальному значению поля будет присвоен определенный стиль. По умолчанию для раскраски применяются случайные цвета (“Random colors”), определенный набор цветов задается в пункте “Градиент” (<a href="#fig-unique_values">Рисунок&nbsp;<span>4.8</span></a>).</p>
<div id="fig-unique_values" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><video src="./videos/vid_4_Уникальные%20значения.mp4" class="img-fluid" controls=""><a href="./videos/vid_4_Уникальные значения.mp4">Video</a></video></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.8: Символизация по уникальным значениям преобладающей породы</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.10
</div>
</div>
<div class="callout-body-container callout-body">
<p>Выберите слой “videla” и примените режим символизации по уникальным значениям для типа леса (поле “tip_lesa”).</p>
</div>
</div>
</section>
<section id="символизация-по-диапазонам-значений" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="символизация-по-диапазонам-значений"><span class="header-section-number">4.7</span> Символизация по диапазонам значений</h2>
<p>Для <strong>количественных</strong> признаков применяется режим <strong>символизация по диапазонам значений</strong>. Диапазон значений признака разбивается на интервалы каждый из которых окрашивается согласно выбранному градиенту цвета. В пункте “Значение” выбирается поле с количественными значениями, в пункте “Градиент” задается градиент цвета который может быть выбран из предустановленного списка или создан вручную по двойному клику.<br>
Ключевым моментом является разбиение числовой переменной на классы (интервалы), которое определяется режимом (“Fixed Interval”, “Logarithmic Scale” и др.) с возможностью выбора количества классов. Увеличение количества классов приводит к более подробному отображению изменений переменной. Способ разбиения на классы часто определяется распределением переменной, которое изображено во вкладке “Диаграмма рассеяния”. После установки всех параметров и нажатия “Классифицировать”, интервалы и соответствующие им стили отображения появятся на экране в виде таблицы со столбцами “Знак”, “Значения” и “Легенда” (<a href="#fig-diapazon_values">Рисунок&nbsp;<span>4.9</span></a>).</p>
<div id="fig-diapazon_values" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/4_1_Диапазоны значений.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.9: Символизация по диапазонам значений площади выдела</figcaption>
</figure>
</div>
<p>В столбце “Знак” возможно отключить видимость отдельного интервала или изменить стиль. В столбце “Значения” отображааются границы интервала, которые возможно изменить вручную. Столбец “Легенда” отображает подписи в легенде, которые так же возможно изменить вручную.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.11
</div>
</div>
<div class="callout-body-container callout-body">
<p>Примените режим символизации по диапазонам значений для среднего возраста (поле “A_let”) слоя “videla” как показано на рисунке ниже (<a href="#fig-diapazon_values_task">Рисунок&nbsp;<span>4.10</span></a>).</p>
</div>
</div>
<div id="fig-diapazon_values_task" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/4_2_Диапазоны значений задание.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.10: Пример символизации по диапазонам значений</figcaption>
</figure>
</div>
</section>
<section id="sec-rules" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="sec-rules"><span class="header-section-number">4.8</span> Cимволизация на основе правил</h2>
<p><strong>Символизация на основе правил</strong> по принципу своей работы схожа с режимом “Подписи на основе правил” (<a href="#sec-labels_by_rules"><span>Глава&nbsp;4.3</span></a>) и позволяет гибко настроить группировку объектов по стилю. В основе этого режима лежат логические выражения, которые разбивают множество объектов на группы для каждой из которых задается свой стиль отображения.</p>
<div id="fig-rules_viz" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/4_3_символизация на основе правил.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.11: Cимволизация на основе правил по среднему возрасту и преобладающей породе</figcaption>
</figure>
</div>
<p>Логические выражения (правила) добавляются при помощи символа <strong>“Добавить правило”</strong>. В пункте <strong>“надпись”</strong> задается называние для правила. В пункте <strong>“Поиск”</strong> задается логическое правило, которое определяет группу объектов, для которых будет задан стиль отображения. Пункт “Иначе для всех остальных объектов” позволяет задать стиль для объектов, не входящих ни в одну группу. Настройка <strong>“В пределах масштаба”</strong> позволяет применять стиль только для определенного диапазона масштаба. В пункте <strong>“Знак”</strong> задается стиль отображения.<br>
Для примера окрасим сосняки более 100 лет и менее 100 лет в разные цвета. Для остальных выделов оставим видимыми только контуры. Первое правило будет иметь вид <strong>“el_lesa” = ‘С’ AND “A_let” &lt; 100</strong> (выбор выделов с преобладающей породой сосна И средним возрастом менее 100 лет). Второе правило вида <strong>“el_lesa” = ‘С’ AND “A_let” &gt;= 100</strong> задает стиль для сосняков со средним возрастом большим или равным 100 лет. В третьем правиле выбирается пункт <strong>“Иначе для всех остальных объектов”</strong> и задается стиль для всех объектов не попавших в первые два правила (<a href="#fig-rules_viz">Рисунок&nbsp;<span>4.11</span></a>).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.12
</div>
</div>
<div class="callout-body-container callout-body">
<p>Повторите пример визуализации по преобладающей породе и возрасту, котороый размещен выше. Результат должен соответствовать рисунку ниже. (<a href="#fig-rules_viz_task">Рисунок&nbsp;<span>4.12</span></a>)</p>
</div>
</div>
<div id="fig-rules_viz_task" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/4_4_символизация по правилам задание.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.12: Результат символизации по преоблаюадей породе и возрасту</figcaption>
</figure>
</div>
</section>
<section id="создание-и-заполнение-макета" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="создание-и-заполнение-макета"><span class="header-section-number">4.9</span> Создание и заполнение макета</h2>
<p>После задания соответствующего стиля объектов переходят к созданию карты. Кроме самого изображения земной поверхности карты и планы могут содержать легенду, координатную сетку, указатель на север, масштаб или масштабную линейку. В главном окне программы задается требуемый стиль отображения карты после чего карта оформляется в пункте меню <strong>“Проект” &gt; “Создать макет…”</strong> вводится название макета и открывается новое окно с белым прямоугольником, который является листом будующей карты. Новые элементы добавляются в меню <strong>“Добавить элемент”</strong>, основные инструменты редактирования макета расположены в панеле слева. Добавленные элементы макета и их свойства отображаются в панеле справа “Элементы” и “Свойства элемента”.<br>
Основным элементом макета является карта, которая добавляется в меню <strong>“Добавить элемент” &gt; “Добавить карту”</strong> после чего выделяется область на белом листе, куда карта будет добавлена.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Обратите внимание!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Печать карты производится только в границах белого листа. Элементы выходящие за эти границы не будут напечатаны.</p>
</div>
</div>
<p>После добавления карты новый элемент с названием “Карта 1” появится в панеле “Элементы”. Панель “Свойства элемента” позволяет изменять настройки добавленной карты (масштаб, систему координат и т.д.). Область, занятая картой, изменяется при помощи инструмента “Выделить/переместить элемент”, предвигать карту внутри области возможно при помощи инструмента “Перемещение содержимого элемента” (<a href="#fig-maket">Рисунок&nbsp;<span>4.13</span></a>).</p>
<div id="fig-maket" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><video src="./videos/4_2_макет.mp4" class="img-fluid" controls=""><a href="./videos/4_2_макет.mp4">Video</a></video></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.13: Использование макета для создания карты</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.13
</div>
</div>
<div class="callout-body-container callout-body">
<p>Создайте новый макет. Добавьте карту так, что бы она занимала приблизительно 80% площади листа.</p>
</div>
</div>
<p>Аналогичным образом добавляется масштабная линейка и другие элементы. Для этого перейдите в пункт “Добавить элемент” и выберите необходимый (так же добавить большинство элементов макета возможно при помощи панели слева).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.14
</div>
</div>
<div class="callout-body-container callout-body">
<p>Добавьте в макет масштабную линейку, указатель “север-юг” и надпись “План лесонасаждений”.</p>
</div>
</div>
<p>Для настройки свойств определенного элемента его необходимо выделить в панеле “Элементы” после чего свойства появятся в окне “Свойства элемента”. После оформления карты обычно сохраняют в виде изображения. Для этого перейдите в пункт <strong>“Макет” &gt; “Экспорт в изображение”</strong> и сохраните результат в папку проекта.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Задание 4.15
</div>
</div>
<div class="callout-body-container callout-body">
<p>Добавьте координатную сетку на карту (система координат EPSG:4326 - WGS84). В свойствах масштабной линейки измените единицы измерения на километры. У надписи “План лесонасаждений” увеличьте размер шрифта до 30. Сохраните карту в виде изображения. Пример итоговой карты приведен на рисунке ниже (<a href="#fig-maket_task">Рисунок&nbsp;<span>4.14</span></a>).</p>
</div>
</div>
<div id="fig-maket_task" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="./pictures/4_5_макет задание.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Рисунок&nbsp;4.14: Пример плана лесонасаждений</figcaption>
</figure>
</div>
<p>Макет со всеми добаленными элементами сохраняется в файле проекта. При необходимости внесения изменений достаточно открыть сохраненный макет, внести изменения и сохранить карту повторно.</p>
</section>
<section id="добавление-легенды" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="добавление-легенды"><span class="header-section-number">4.10</span> Добавление легенды</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопировано");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопировано");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter3_attributes.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Добавление атрибутивной информации</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter5_queries.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Поиск объектов по атрибутивной информации и пространственному положению</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>