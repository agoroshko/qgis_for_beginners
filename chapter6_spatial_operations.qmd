# Пространственные операции

::: {.callout-note}
## Загрузите файлы!
Для выполнения заданий из раздела "Запросы" загрузите файлы по [ссылке 1](https://disk.yandex.ru/d/sctgkoDXQdI7Vw) или [ссылке 2](https://github.com/agoroshko/qgis_for_beginners/tree/main/files) и создайте новый проект:

- Создайте новую папку проекта под названием "Раздел 6" а так же новый проект в QGIS;
- Загрузите файлы в QGIS;
- Задайте систему координат проекта EPSG:32646;
- Сохраните файл проекта в папку проекта "Раздел 6". 
:::

Панель меню **"Вектор" > "Геообработка"** содержит основные инстументы для изменения векторных объектов (@fig-geotools). 

![Инструменты геообработки](./pictures2/6_1_Инструменты геообработки.png){#fig-geotools}

По умолчанию, результатом применения каждого инструмента является временный векторный слой с измененной геометрией. Временные слои помечены иконкой ![1](./QGIS_icons/mIndicatorMemory.svg) справа от названия (см. @fig-temp_layer).

![Временный слой "Буферизовано" в панеле слоев](./pictures/6_2_временный слой в панеле слоев.png){#fig-temp_layer}

Если требуется сделать временный слой постоянным, в контекстном меню слоя выберите пункт **"Сохранить на диск..."** и задайте параметры сохранения, в противном случае, после закрытия проекта данные слоя будут потеряны. При попытке закрытия проекта с несохраненными временными слоями появится соответствующее предупреждение (@fig-temp_layers_warn).

![Предупреждение о несохраненных временных слоях](./pictures/6_1_Предупреждение о временных слоях.png){#fig-temp_layers_warn}

## Изменение системы координат слоя {#sec-ref_sys}

В некоторых случаях требуется изменить систему координат слоя. Например, для построения буфера (см. @sec-buffer) в метрах (а не градусах) тебуется спроецированная (плоская) система координат. Изменить систему координат векторного слоя возможно при помощи инструмента **"Вектор" > "Управление данными" > "Перепроецировать слой..."**. В пункте **"Исходный слой"** задается слой, проекцию которого необходимо изменить. Пункт **"Целевая система координат"** определяет новую систему координат. По умолчанию инстумент создает временный слой (@fig-reproject_layer).

![Инструмент "Перепроецировать слой"](./pictures/6_3_Перепроецировать слой.png){#fig-reproject_layer}

::: {#task-task_rivers_reproj .callout-tip}
Перепроецируйте слой "rivers" в систему координат "EPSG:32646 - WGS84 / UTM zone 46N". Переименуйте появившийся временный слой из "Перепроецировано" в "rivers UTM 46N". Сохраните временный слой в папку проекта.
:::

## Создание буферной зоны{#sec-buffer}

Буферные зоны используются для обозначения области постоянного радиуса вокруг объекта. В лесном хозяйстве буферные зоны чаще всего используются для выделения водоохраннных зон вокруг рек или разрядов такс вывозки древесины (в этом случае буферные зоны выглядят в виде кругов с пунктом реализации древесины в центре).

!!! Рисунки водоохранных зон и таксовых районов добавить!

Инструмент **"Вектор" > "Геообработка" > "Буферизация..."** (@fig-buffer) создает область постоянного радиуса вокруг каждой геометрии слоя: буферную зону или буфер. Единицы измерения радиуса (задается в пункте **"Расстояние"**) будут зависить от системы координат слоя. В географической системе координат радиус задается в угловой мере (градусах), что не очень удобно. Поэтому для построения буфера в линейной мере (метрах, километрах и т.д.), сначала проводят перепроецирование в "плоскую" (спроецированную) систему координат (это действие было выполнено в предыдущем @task-task_rivers_reproj), после чего строят буфер заданного радиуса. Чек-бокс **"Результат объединения..."** определяет будет результат представлен объединенной геометрией или отдельными геометриями для каждого объекта. 

![Инструмент "Буферизация"](./pictures2/6_3_Инструмент буферизации.png){#fig-buffer}

::: {#task-task_buffer .callout-tip}
Постройте буферы радиусом 100 метров вокруг рек (слой "rivers UTM"). Слою буферных зон задайте название "буфер рек 100 м" и сохраните в папку проекта.
Результат выполнения задания изображен на рисунке (@fig-buffer_result).

![Результат применения инструмента "Буферизация"](./pictures/6_5_результат буферизации.png){#fig-buffer_result}
:::

## Инструменты "Обрезать..." и "Пересечение..."   

Часто требуется обрезать один слой по границам другого. Для выполнения такой операции применяется инструмент **"Вектор" > "Геообработка" > "Обрезать..."**. Алгоритм обрезает **"Исходный слой"** по границам **"Слоя наложения"**. В результате будут сохранены только те части **исходного слоя**, которые пересекаются со **слоем наложения** (@fig-cut). 

![Инструмент "Обрезать"](./pictures2/6_4_Инструмент обрезать.png){#fig-cut}

::: {#task-task_cut .callout-tip}
Создайте слой частей выделов, которые попадают в стометровые буферные зоны вокруг рек. Для этого, по примеру выше, примените инструмент "Обрезать..." к слоям "videl" и "буфер рек 100 м". Сохраните временный слой на диск под названием "Части выделов в водоохранной зоне". Результат выполнения задания приведен на рисунке ниже (@fig-cut2).

![Применение инструмента "Обрезать"](./pictures/6_7_части выделов в водоохранной зоне.png){#fig-cut2}
:::

Похожим на инструмент **"Обрезать"** функционалом обладает инструмент **"Вектор" > "Геообработка" > "Пересечение..."**. Однако, если первый инструмент просто обрезает по границе, инструмент **"Пересечение"** так же копирует атрибуты слоя наложения в слой-результат. Воспользуемся инструментом **"Пересечение"** что бы определить к водоохранным зонам каких рек принадлежит та или иная часть выдела. На данный момент в проект имеется слой "Буфер рек 100 м" в атрибутах которого присутствует поле "name", определяющее к какой реке относится тот или иной буфер (это поле было наследовано из слоя rivers) (@fig-intersect_atribut). Используем слои "videl" и слой "Буфер рек 100 м" в инструменте "Пересечение" (@fig-intersect_tool). В настройках инструмента возможно задать поля исходного слоя и слоя наложения, которые останутся в результирующем слое (по умолчанию выбраны все поля). В исходном слое выберем поля: **"fid", "kvartal", "videl", "zapax_1_ha"** (@fig-intersect_layer1). В слое наложения выберем поле **"name"** (@fig-intersect_layer2). В результате применения инструмента в панеле слоев появится новый временный слой "Пересечение". Результат будет идентичен применению инструмента **"Обрезать"**, за исключением таблицы атрибутов, которая будет содержать выбранные поля одного и другого слоя.


::: {#fig-intersect_settings layout-ncol=2}

![Таблица атрибутов слоя "Буфер рек 100 м"](./pictures2/6_5_1_Атрибуты буфера.png){#fig-intersect_atribut}

![Окно настройки инструмента "Пересечение"](./pictures2/6_5_2_Инструмент Пересечение.png){#fig-intersect_tool}

![Сохраняемые исходные поля](./pictures2/6_5_3_Сохраняемые исходные поля.png){#fig-intersect_layer1}

![Сохраняемые поля слоя наложения](./pictures2/6_5_4_Сохраняемые поля слоя наложения.png){#fig-intersect_layer2}

Настройки инструмента "Пересечение"
:::

::: {#task-task_cut .callout-tip}

- По примеру выше, примените инструмент "Пересечение" к слоям "videl" и "Буфер рек 100 м". 
- Полученный векторный слой сохраните на диск под названием "Результат пересечения выделов и буферных зон". 
- Задайте стиль слоя так, что бы выделить цветом выделы, принадлежащие буферным зонам разных рек. Результат выполнения задания отображен на рисунках ниже (@fig-intersect_result, @fig-task_intersect).

![Таблица атрибутов слоя "Результат пересечения выделов и буферных зон"](./pictures2/6_6_2_Таблица атрибутов слоя пересечение.png){#fig-intersect_result}

![Применение инструмента "Пересечение"](./pictures2/6_6_Результат пересечения.png){#fig-task_intersect}
:::



```{r}
#| echo: false
# !!!! Добавить: буферы переменного радиуса??????
```


## Инструмент "Разность..."

Инструмент **"Вектор" > "Геообработка" > "Разность..."** проводит обратную операцию: из исходного слоя вырезаются части, пересекающиеся со слоем наложения.

::: {#task-task .callout-tip}
Используя инструмент "Разность", вырежите части выделов, которые попадают в стометровые буферы вокруг рек. Для этого примените инструмент "Разность..." к слоям "videl" и "Буфер рек 100 м". Сохраните результат в папку проекта. Результат выполнения задания приведен на рисунке (@fig-diff).

![Инструмент "Разность"](./pictures/6_8_инструмент разница.png){#fig-diff}
:::

Инструмент **"Вектор" > "Геообработка" > "Объединение по признаку..."** позволяет объединить объекты с одинаковыми атрибутами. Например, он дает возможность создать границы лесных кварталов из слоя выделов. Для этого в качестве **"Исходного слоя"** выбирают слой выделов, в пункте **"Поля классификации"** выбирают поле для объединения объектов ("kvartal") (@fig-merge_by_attr). В результате применения инструмента, границы выделов с одинаковым номером квартала будут стерты и таким образом образуют квартальную сеть.

![Настройки инструмента "Объединение по признаку"](./pictures2/6_7_Объединение по признаку.png){#fig-merge_by_attr}

::: {#task-merge_videls .callout-tip}
По примеру выше, объедините выделы в слое "videl" по полю "kvartal". В результате должен появиться новый временный слой с границами кварталов (см. @fig-merge_result). Сохраните слой на диск под названием "kvartal".

![Результат применения инструмента "Объединение по признаку"](./pictures2/6_8_Квартальная сеть.png){#fig-merge_result}
:::

```{r}
#| echo: false
# !!!!!!! Добавить задания по другим инструментам !!!
```


## Подсчет длины, площади и периметра геометрий.

Программа QGIS позволяет совершить автоматический расчет площади, периметра и длины геометрий. При таком расчете важно обратить внимание на единицы измерения величин. Единицы измерения длины (так же как периметра и площади) зависят от настроек проекта. Для их изменения перейдите в пункт меню **"Проект" > "Свойства" > во вкладке "Общие" найдите раздел "Измерения"**. Пункты **"Единицы измерения расстояния"** и **"Единицы измерения площади"** задают соответствующие единицы измерения.

::: {#task-task_measure_units .callout-tip}
Перейдите в пункт меню **"Проект" > "Свойства" > во вкладке слева "Общие" найдите раздел "Измерения"** (см. @fig-measure_units). Пункты **"Единицы измерения расстояния"** укажите "метры" в пункте **"Единицы измерения площади"** укажите "гектары". Примените изменения.

![Настройка единиц измерения проекта](./pictures2/6_9_Единицы измерения.png){#fig-measure_units}
:::

Для подсчета длины геометрий, в таблице атрибутов создают новое поле (тип поля целое или десятичное число) и заполняют его выражением `$length` которое вычисляет длину для каждой геометрии слоя.

::: {#task-length .callout-tip}
В слое **"roads"** создайте новое поле **"length_m"** (тип поля целое число). Заполните это поле длиной каждой из дорог в метрах. Сохраните изменения в слое. Cуммарная длина дорог должна составить **17 055 м** (см. @vid-length).

![Подсчет длины дорог для слоя "roads"](./videos/6_1_длина дорог.mp4){#vid-length}
:::

Периметр и площадь геометрий вычисляются аналогично при помощи функций `$perimeter` и `$area` соответственно.

::: {#task-perim .callout-tip}
В слое **"videla"** создайте новое поле **"perimeter_m"** (тип поля десятичное число). Заполните это поле значениями периметра (в метрах) для каждого выдела. Сумма периметров выделов должна составить **335 649,9 м**.
:::

Для выполнения предыдущих заданий (@task-length, @task-perim) использовались два действия:
1. Создавалось поле с нужным типом данных
2. Созданное поле заполнялось значениями функции ($length, $area и др.)
Инструмент "Калькулятор полей" позволяет совместить эти два действия: задаются параметры поля и функция, значениями которой это поле будет заполнено.

!!! Рисунок Калькулятора полей с настройками заполнения поля area_ha

::: {#task-calc_area .callout-tip}
В слое **"videla"** при помощи **калькулятора полей** создайте новое поле **"area_ha"** (тип поля десятичное число) заполненное значением площади (в гектарах) для каждого выдела. Сумма площадей выделов должна составить **1 039,8 га**.
:::

## Арифметические операции с атрибутами

После выполнения @task-calc_area в слое "videla" будут находиться два поля с площадью. Поле "s_ha" это данные площади выдела по таксационным описаниям. Второе поле "area_ha" было создано при выполнении @task-calc_area и содержит площади геометрий, рассчитанные автоматически. 
Отличаются ли эти две площади? Для сравнения двух значений создайте новое поле "diff_area" (десятичное) куда будет записана разность значений двух полей (выражение `"s_ga" -  "area"`). По разнице можно оценить насколько значения двух полей различаются.

::: {#task-task_diff_area .callout-tip}
+ В слое **"videla"** создайте поле **"diff_area"**. Заполните это поле выражением `"s_ha" - "area"` для подсчета различий между площадями. 
+ Создайте карту, где выделы с разностью по абсолютному значению более 0.3 га будут окрашены в красный цвет. Обртите внимание - разность может быть как положительной, так и отрицательной, для получения абсолютного значения используйте функцию `abs()`. 
+ Создайте новый макет и сохраните карту как изображение. Результат выполнения задания приведен на рисунке ниже (@fig-diff_03).
:::

![Выделы с ошибкой площади более 0,3 га](./pictures/6_9_разница 0,3 га.png){#fig-diff_03}

Более корректно использовать относительную разность (в процентах) а не абсолютные значения. Для этого создадим новое поле "diff_area_perc" (тип поля - десятичное) и заполним его выражением `abs("area" * 100 / "s_ga" - 100)`. Функция `abs()` возвращает абсолютное значение выражения в скобках.

::: {#task-diff_area_perc .callout-tip}
+ В слое **"videla"** создайте новое поле "diff_area_perc". Заполните это поле относительной разностью полей `abs("area" * 100 / "s_ga" - 100)`. 
+ Создайте карту, где выделы с разностью более 15 % (поле "diff_area_perc") будут окрашены в красный цвет.
+ Создайте новый макет и сохраните карту как изображение. Результат выполнения задания приведен на рисунке ниже (@fig-diff_15).
:::

![Выделы с ошибкой площади более 15 %](./pictures/6_10_разница 15 perc.jpg){#fig-diff_15}


## Ситуационное задание №1

Этой задание является обобщением полученных навыков. Последовательно применяйте изученные в этом разделе инструменты и решите практическую задачу.

::: {#task-task_6_1 .callout-tip}
Рассчитайте запас насаждений в водоохранных зонах Караульного лесничества. Выполните следующие этапы задания:

+ Постройте буферные зоны радиусом 50 метров вокруг рек (см. @task-task_buffer).
+ Создайте новый слой, содержащий части выделов, попадающих в водоохранные зоны (см. @task-task_cut).
+ Рассчитайте площади частей выделов, попадающих в водоохранные зоны. Для этого создайте новое поле "area_buffer_ha", заполните его площадью частей выделов (в гектарах) (см. @task-calc_area).
+ Рассчитайте запас для частей выделов. Для этого создайте новое числовое поле "zapas_buffer", заполните его произведением новой площади выдела (поле "area_buffer_ha") и запаса на 1 га (поле "zapas_1ga") (см. @task-task_diff_area).
+ Сохраните таблицу с запасами в водоохранной зоне как табличный файл Excel (.xlsx). Для этого в контекстном меню слоя выберите пункт "Экспорт" > "Сохранить объекты как...", после чего укажите необходимый формат и сохраните файл в папку проекта.
+ Проведите подсчет суммарного запаса в водоохранных зонах, запас должен быть равен **15 279,11 $м^3$**.
:::

## Ситуационное задание №2

Для расчета стоимости аренды лесных участков для заготовки древесины, используется система таксовых раздядов. Каждый из разрядов покрывает зону определенного радиуса от пункта отгрузки древесины:

+ 1 разряд от 0 до 10 км
+ 2 разряд от 10,1 до 25 км
+ 3 разряд от 25,1 до 40 км
+ 4 разряд от 40,1 до 60 км
+ 5 разряд от 60,1 до 80 км
+ 6 разряд от 80,1 до 100 км

Разряд такс устанавливается для каждого квартала в зависимости от того, в какую зону он попадает, для этого вокруг пункта отгрузки древесины строятся буферные зоны.

::: {#task-task .callout-tip}
Постройте карту разрядов такс для части Караульного лесничества. Пунктом отгрузки будет служить здание речного вокзала в г. Красноярск.
Для решения задачи выполните следующие этапы задания:

+ Создайте новый векторный точечный слой и отметьте пункт отгрузки (поскольку в последующем вокруг пункта придется строить буферные зоны, выберите для слоя систему координат UTM (см. @task-task_utm)). Поставить пункт отгрузки вам поможет Гугл карта (см. @task-google_map).
+ Постройте буферные зоны разрядов такс вокруг пункта отгрузки (см. @task-task_buffer).
+ Что бы удалить артефакты на квартальной сети, используйте инструмент "Удалить отверстия" в панеле "Инструменты анализа" (в поле "Удалить отверстия площадью меньше чем" укажите значение 0.01 квадратный градус).
+ Оформите карту в виде макета и сохраните в изображение (цвета выберите произвольно).

Результат выполнения задания представлен на рисунке (см. @fig-case_2).
:::

![Результат выполнения задания №2](./pictures/6_13_case2.jpeg){#fig-case_2}

## Построение полигона по координатам

В лесном хозяйстве не редко приходится рещать задачу построения полигона по каталогу координат. Решение такой задачи можно разбить на два этапа:

+ Импорт каталога координат в QGIS и отображение его в виде точек на карте;
+ Преобразование точек в линию а затем в полигон.

Каталог координат представляет из себя таблицу с координатами и порядковыми номерами точек. Так же в таблице должна быть указана система координат. Рассмотрим каталог координат в файле **"Координаты.xlsx"**, представленный таблицей Excel.

!! Рис - Каталог координат в программе LibreOffice Calc

Файл состоит из заголовка (перва строка) в котором указана система координат и таблицы (каталога координат) с 3 столбцами: n - порядковый номер точки, lat_wgs84 - широта точки, град., lon_wgs84 - долгота точки, град. Так же обратите внимание на то, что в координатах целая часть от дробной отделена запятой (это понадобится при настройке импорта файла).
Сохраним таблицу в формат **.csv (Comma-Separated Values, значения разделенные запятой)**, позволяющий хранить табличные данные в текстовом формате. Разделителем полей может служить не только запятая, основное условие - символ-разделитель не должен присутствовать в данных таблицы. В нашем случае использовать запятую не самое лучшее решение т.к. запятая присутствует в данных таблицы в виде десятичного разделителя. Лучшим решением будет использовать в качестве разделителя полей символ табуляции.

::: {#task-task .callout-tip}
Воспользуйтесь табличным редактором и откройте файл "Координаты.xlsx". Сохраните содержимое таблицы в формат .csv "Координаты.csv". В качестве разделителя полей используйте символ табуляции.
:::

Теперь пришло время импортировать файл "Координаты**.csv**" в прорамму QGIS. Перейдите в пункт меню **"Слой" > "Добавить слой" > "Добавить слой из текста с разделителями..."**. В пункте **"Имя файла"** выберите файл **"Координаты.csv"**. Настроим параметры импорта: **"Формат файла" > "Другие разделители" > поставьте чек-бокс напротив пункта "Табуляция"** (здесь задается разделитель полей, который был выбран при сохранении файла .csv - табуляция). "Параметры записей и полей" > "Игнорировать строки в начале файла" > укажите значение 1 (первая строка содержит название системы координат, поэтому при чтении файла будет пропущена). Так же сообщим программе о том, что наша таблица имеет заголовки в 1 строке (по счету это 2 строка, но в настройке выше первая строка была пропущена): чек-бокс "Загружать имена полей из первой строки".
Вкладка **"Формат геометрии"** определяет настройки системы координат а так же поля, из которых эти координаты будут извлечены. Выбирается режим "Координаты точки", "Поле х" > "lon_wgs84" (указывается столбец с долготой точки), "Поле y" > "lat_wgs84" (указывается столбец с широтой точки), "Система координат геометрии" > "EPSG:4326 WGS84". Убедитесь в том, что в пункте "Примеры данных" таблица выглядит корректно, после чего нажмите "Добавить", новый точечный векторный слой появится в панеле слоев.

После добавления слоя следует пересохранить его в Shape-file или GeoPackage.

::: {#task-task .callout-tip}
По примеру выше, импортируйте координаты точек (файл .csv). Сохраните импортированный слой точек в файл.
:::

Путь преобразования точек в полигон проходит через промежуточный этап: создание линий. Для этого в панеле "Инструменты анализа" выберите инструмент "Точки в контур".

"Исходный слой" > точечный слой "Координаты", поставьте чек-бокс "Создать замкнутые контуры". Так же при желании можно задать поле, определяющее порядок вершин в линии (поле "Выражение порядка"). По умолчанию порядок будет определяться номером строки в таблице атрибутов. После всех настроек нажмите "Выполнить", новый линейный слой ("Пути") появится в панеле слоев.

Осталось линейный слой трансформировать в полигональный. Для этого используют инструмент "Построить полигоны" или "Линии в полигоны".

!! Рис - Полигон, построенный из линий

::: {#task-task .callout-tip}
По примеру выше, трансформируйте точки в линии а затем в полигон. Сохраните полигон как новый векторный слой.
:::

## Создание каталога координат

В некоторых случаях необходимо решить обратную задачу - получить каталог координат поворотных точек полигонального слоя. При этом получить координаты точек часто необходимо в СК отличной от СК полигонального слоя, или сразу в нескольких СК. Рассмотрим второй случай, когда дан полигон (СК WGS84) и нужно получить координаты его поворотных точек в двух СК: WGS84 и GSK2011.

!!Рис - Пример каталога координат (каждая поворотная точка записана в двух СК)


::: {.callout-note}
## Загрузите файлы!
Для выполнения заданий из подраздела "Создание каталога координат", загрузите файл полигона в существующий проект QGIS. Файл можно загрузить по ссылке ()
:::

Решение задачи будет состоять из следующих этапов:

+ Извлечение вершин из полигона
+ Добавление полей (широта, долгота) и расчет координат в СК WGS84
+ Перепроецирование слоя в СК GSK2011
+ Добавление полей (широта, долгота) и расчет координат в СК GSK2011
+ Сохранение координат в таблицу

Инструмент "Извлечь вершины" создает новый точечный слой, содержащий вершины геометрий исходного линейного или полигонального слоя.

::: {#task-task .callout-tip}
Примените инструмент "Извлечь вершины" к полигону.
:::

Системы координат исходного полигонального и созданного точечного слоев совпадают (WGS84). Для записи координат, создадим дополнительные 2 поля в атрибутах слоя (широта - lat, долгота - lon), тип поля - десятичное (real). Заполним каждое из полей функциями `round(x($geometry), 6)` для долготы и `round(y($geometry), 6)` для широты. Функции `x($geometry)`, `y($geometry)` возвращают координату точки по долготе и широте, соответственно. Функция `round(value, digit)`  используется для округления координат до 6 знаков после запятой. Она требует два аргумента: value - число, которое нужно округлить; digit - количество знаков после запятой. Функция `round(value, digit)` часто используется вместе с такими функциями как `$length` и `$area`.

::: {#task-task_calc_coords .callout-tip}
Рассчитайте координаты в таблице атрибутов точечного слоя (СК WGS84).

!! Рис - Результат выполнения задания.
:::

Для того, что бы получить координаты тех же объектов в другой СК, необходимо перепроецировать слой (см. @task-task_rivers_reproj) и повторить действие выше т.е. создать еще два поля и заполнить их функциями `round(x($geometry), 6)` и `round(y($geometry), 6)`.

::: {#task-task .callout-tip}
Перепроецируйте слой в СК GSK2011. Создайте два новых поля (lat_gsk2011 и lon_gsk2011) и заполните их координатами (см. @task-task_calc_coords). Сохраните таблицу атрибутов в файл Excel (см. @task-task_6_1).

!! Рис - Cохраненная таблица атрибутов.
:::


## Расчет азимутов

Буссольная съемка широко распространена в лесном хозяйстве при отводе лесосек. Она основана на полярной системе координат при которой определяется длина и направление линии (румб или азимут). Знание этих величин для каждой из линий необходимо для вынесения границ участка на местность при помощи буссоли.

::: {.callout-note}
## Загрузите файлы!
Для выполнения заданий из подраздела "Расчет азимутов", загрузите файл полигона в существующий проект QGIS. Файл можно загрузить по ссылке ()
:::

Решение задачи будет состоять из следующих этапов:

+ Конвертирование границы полигона в линию
+ Разделение линии на отрезки
+ Расчет длины и азимута для каждого отрезка в таблице атрибутов

В качестве исходных данных используется полигон условной лесосеки. Для конвертирования его границы в линию применяется инструмент "Полигоны в линии". В результате граница полигона будет представлена в виде линии, которую необходимо разбить на отрезки инструментом "Разбить линии на отрезки". Для каждого из полученных отрезков необходимо добавить 2 поля в которые записать длину и азимут. С расчетом длины при помощи функции `$length` вы уже сталкивались (см. @task-length). Расчет азимутов линий несколько сложнее и включает в себя несколько функций.
Для расчета азимутов линий используется функция `azimuth(point_a, point_b)`, где `point_a` - начальная точка отрезка; `point_b` - конечная точка отрезка. Произвести расчет начальной а конечно точек возможно при помощи функций `start_point(@geometry)` и `end_point(@geometry)`. В результате получаем следующее выражение: `azimuth(start_point(@geometry), end_point(@geometry))`. Однако полученное выражение будет рассчитывать направление линии в радианах. Для пересчета радиан в градусы поместим выражение в фукцию `degrees()`. Итоговое выражение будет выгрядеть как: `degrees(azimuth(start_point(@geometry), end_point(@geometry)))`. 

::: {#task-task .callout-tip}
По описанию выше рассчитайте длины линий и азимуты для полигона. Сохраните их в таблицу Excel. Результат выполнения задания приведен на рисунке ниже.

!! Рис - Таблица азимутов и длин линий.
:::




```{r}
#| echo: false

## Работа со списками координат (даны координаты, построить полигон, рассчитать площадь, переввести в ГСК и создать каталог координат)


# пролоджение раздела в файле chapter.6_2_new.qmd

# Финальное задание доработать!!!!

# !!Видео выполнения задания добавить!



# !! Добавить задания на основе osm и границ лесничеств КК.
# !!! Рассчитать протяженность дорог в границах какого-либо лесничества (суммарную протяженность показать в таблице).
# !!! Найти точки пересечения рек и дорог в границах лесничества.
```


