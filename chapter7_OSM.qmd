
# Open Street Map (OSM)

[Open Street Map (OSM)](https://www.openstreetmap.org/#map=9/55.983/92.873) это некоммерческий проект по созданию подробной, свободной и бесплатной географической карты мира. Наполнение карты осуществляется участниками проекта OSM на добровольных началах. Проект функционирует по принципу Википедии: любой участник может добавлять объекты и их описание на карту. Данные OSM распространяются свободно под открытой лицензией Open Database License. OSM является одним из самых крупных источников информации для создания ГИС.

::: {.callout-note}
## Загрузите файлы!
Для выполнения последующих заданий загрузите файл по [ссылке 1]() или [ссылке 2](https://disk.yandex.ru/d/oCsbwolnayypiA) и создайте новый проект:

- Создайте новую папку проекта под названием "Раздел 7 OSM" а так же новый проект в QGIS.
:::

Файл **"osm.gpkg"** является файлом GeoPackage и содержит несколько векторных слоев для территории Красноярского края, полученных из базы данных Open Street Map (получить аналогичные данные возможно по [ссылке](https://download.geofabrik.de), регион - Siberian Federal District). При загрузке файла **"osm.gpkg"** появится окно выбора слоев для загрузки в проект. По умолчанию выбраны все слои, но возможно выбрать только некоторые слои из списка. Все слои содержатся в одном файле **"osm.gpkg"** который является контейнером базы данных SQLite. В описании каждого слоя указывается тип геометрии и количество объектов (@fig-choice).

![Окно выбора слоев файла "osm.gpkg"](./pictures2/7_1_Загрузка слоев.png){#fig-choice}

::: {#task-task .callout-tip}
## Задание
Загрузите в проект все слои из файла "osm.gpkg". Сохраните проект в папку проекта под названием "Раздел 7 OSM".
:::

В результате выполнения задания загружено 6 слоев: 

- **"level_6"** - административные районы в границах Красноярского края;
- **"places"** - населенные пункты; 
- **"railways"** - железные дороги; 
- **"roads"** - дороги; 
- **"water"** - площадные водные объекты (крупные реки, озера); 
- **"waterways"** - линейные водные объекты (реки в виде линий).

## Создание границы Красноярского края

Для создания границы Красноярского края из слоя **"level_6"** применяется инструмент **"Вектор" > "Геообработка" > "Объединение по признаку..."**. В качестве исходного слоя указывается **"level_6"**, в пункте **"поле слияния"** отмечается поле - **"admin_level"**. В результате геометрии с одинаковым атрибутом "admin_level" будут объединены между собой. Поскольку все геометрии слоя имеют одинаковое значение в поле **"admin_level"** (число 6), они будут объединены, создав таким образом границу Красноярского края (@fig-border).

![Результат применения инструмента "Объединение по признаку"](./pictures/6_12_Граница КК.png){#fig-border}

::: {#task-task .callout-tip}
## Задание
Создайте границу Красноярского края по примеру выше. Сохраните слой в файл "osm.gpkg" под названием "border" (@vid-addfile).

!["Объединение по признаку", поле "admin_level"](./videos/6_2_объединение по признаку.mp4){#vid-addfile}
:::

## Подготовка данных

Векторный слой **"places"** выходят за территорию Красноярского края. Обрежем слой по границе полигона "border" что бы удалить населенные пункты не входящие в границы Красноярского края. Для этого используется инструмент **"Обрезать"** (см. @task-task_cut).

::: {#task-task .callout-tip}
## Задание
Используйте инструмент "Обрезать" для обрезки слоя "places" по границе Красноярского края. Сохраните слой в файл "osm_krai.gpkg" под названием "places_border".
:::


## Кейсовые задания

Кейсовые задания предполагают решение задач с применением уже изученных и новых инструментов. Это комплексные задания, требующие декомпозиции задачи и решения в несколько шагов, на каждом из которых применяется свой набор инструментов. Для решения последующих задачь Вы можете использовать любые источники информации а так же помощь ваших коллег.  
Часть инструментов, необходимых для решения задач, находится в меню "Инструменты анализа" (@fig-geotools). Для быстрого поиска нужного инструмента лучше всего использвать поиск по названию.

![Окно "Инструменты анализа"](./pictures2/7_2_Инструменты анализа.png){#fig-geotools}

Окно **"Инструменты анализа"** открывается в правой части программы нажатием на иконку **"Панель инструментов"** ![1](./QGIS_icons/processingAlgorithm.svg). Если иконка отсутствует, убедитесь что в пункте **"Модули" > "Управление модулями..." > вкладка слева "Установленные"** присутствует галочка напротив инструмента **"Processing"**. Если галочка отсутствует - поставьте ее (см. @fig-processing).

![Активация модуля "Processing" (галочка установлена)](./pictures2/7_3_Модули processing.png){#fig-processing}

### Кейс 1 Вычисление протяженности автомобильных дорог по муниципальным районам

**Задача:** Вычислить протяженность крупных дорог (в слое "roads", в поле "fclass" это значения 'trunk', 'primary' и 'secondary') для каждого муниципального района Красноярского края. В результате должна быть получена таблица с суммарной длиной дорог на территории каждого района.

!!! Фото результата.



**Исходные данные:** слои "roads" и "level_6".

**Описание:**

Сначала следует рассмотреть структуру исходных слоев:

- слой "level_6" содержит полигоны, границы муниципальных районов Красноярского края. В таблице атрибутов содержится название для каждого района (поле "local_name");
- слой "roads" содержит линейные объекты, дороги. В атрибутах слоя указаны характеристики дорог, в том числе в поле "fclass" указан тип дороги ([подробнее о типах дорог в OSM](https://wiki.openstreetmap.org/wiki/Key:highway)). Согласно заданию, из всех дорог необходимо выбрать дороги с типами 'trunk', 'primary' и 'secondary'.

Для последующего подсчета длины нужно разбить дороги на части по границам муниципальных районов и добавить поле принадлежности к тому или иному району (инструмент "Пересечение").

После чего в слой дорог добавляют еще одно поле в котором рассчитывают длину каждой части дороги. На последнем этапе суммирую протяженность дорог для каждого муниципального района (инструмент "Агрегировать"). При этом геометрии дорог так же будут объединены в приделах района.

**Этапы выполнения:**

- из слоя "roads" выбрать нужные типы дорог (в поле "fclass" значения 'trunk', 'primary' и 'secondary');
- используйте инструмент "Пересечение", что бы обрезать дороги по границам муниципальных районов и добавить в атрибуты дорог название муниципального района;
- у каждой дороги рассчитать длину (в километрах);
- используйте инструмент "Агрегировать" для того, что бы рассчитать суммарную протяженность дорог для каждого района;
- сохраните таблицу в файл .xlsx.




### Кейс 2 Определить все ЖД мосты (пересечения ЖД с реками)

**Задача:** Рассчитать количество железнодорожных мостов в каждом административном районе. Создать карту.

**Исходные данные:** слои "railways", "waterways" и "level_6".

**Описание:**

Исходными данным для выполнения задания являются слои административных районов ("level_6"), слой железных дорог ("railways") и линейный слой рек ("waterways"). 



**Этапы выполнения:**

- Выбрать из слоя "waterways" крупные реки (в поле "fclass" значение "river");
- Получить точечный слой пересечений крупных рек и железных дорог (инструмент "Пересечения линий");
- Построить буферы радиусом 30 м с объединением пересекающихся буферов (перед этим нужно; перепроецировать слой в систему координат ESRI: 102025);
- Извлечь центроиды из буферов (инструмент "Центроиды", чек-бокс "Создать центроиды для каждой части");
- Рассчитать количество мостов в каждом административном районе (инструмент "Подсчет точек в полигоне").
- Составить карту количества ЖД мостов по регионам (стиль "Символизация по диапазонам значений").





### Кейс 3 Рассчитать площадь, покрытую водной поверхностью для каждого муниципального района.

**Задача:** Рассчитайте площадь покрытия муниципальных районов реками и озерами.

**Исходные данные:**

**Описание:**



**Этапы выполнения:**


