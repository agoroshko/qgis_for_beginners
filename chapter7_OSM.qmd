
# Open Street Map (OSM)

[Open Street Map (OSM)](https://www.openstreetmap.org/#map=9/55.983/92.873) это некоммерческий проект по созданию подробной, свободной и бесплатной географической карты мира. Наполнение карты осуществляется участниками проекта OSM на добровольных началах. Проект функционирует по принципу Википедии: любой участник может добавлять объекты и их описание на карту. Данные OSM распространяются свободно под открытой лицензией Open Database License. OSM является одним из самых крупных источников информации для создания ГИС.

::: {.callout-note}
## Загрузите файлы!
Для выполнения последующих заданий загрузите файлы по [ссылке 1]() или [ссылке 2]() и создайте новый проект:

- Создайте новую папку проекта под названием "Раздел 6 OSM" а так же новый проект в QGIS.
:::

Файл **"osm.gpkg"** является файлом GeoPackage и содержит несколько векторных слоев для территории Красноярского края, полученных из Open Street Map (получить аналогичные данные из базы данных OSM возможно на сайте https://download.geofabrik.de). При загрузке файла **"osm.gpkg"** появится окно выбора слоев для добавления в проект. По умолчанию выбраны все слои, так же возможно выбрать некоторые слои из списка. В описании каждого слоя указывается тип геометрии и количество объектов (@fig-choice).

![Окно выбора слоев файла "osm.gpkg"](./pictures/6_11_Выбор слоев.png){#fig-choice}

::: {#task-task .callout-tip}
## Задание
Загрузите в проект все слои из файла "osm.gpkg". Сохраните проект в папку проекта под названием "Раздел 6 OSM".
:::

В результате выполнения задания загружено 6 слоев: 

- **"level_6"** - деление Красноярского края на районы (название района - поле "local_name"); 
- **"railways"** - железные дороги; 
- **"roads"** - дороги; 
- **"transport"** - остановочные пункты; 
- **"water"** - площадные водные объекты (крупные реки, озера); 
- **"waterways"** - линейные водные объекты (небольшие реки).

## Создание границы Красноярского края

Для создания границы Красноярского края из слоя **"level_6"** применяется инструмент **"Вектор" > "Геообработка" > "Объединение по признаку..."**. В качестве исходного слоя указывается **"level_6"**, в пункте **"поле слияния"** отмечается поле - **"admin_level"**. В результате геометрии с одинаковым атрибутом "admin_level" будут объединены между собой. Поскольку все геометрии слоя имеют одинаковое значение, они будут объединены, создав таким образом границу Красноярского края (@fig-border).

![Результат применения инструмента "Объединение по признаку"](./pictures/6_12_Граница КК.png){#fig-border}

::: {#task-task .callout-tip}
## Задание
Создайте границу Красноярского края по примеру выше. Сохраните слой в файл "osm.gpkg" под названием "border" (@vid-addfile).

!["Объединение по признаку", поле "admin_level"](./videos/6_2_объединение по признаку.mp4){#vid-addfile}
:::

## Подготовка данных

Векторные слои выходят за территорию Красноярского края, поэтому для начала обрежем слои по границе полигона "border". Для этого поочередно примените инструмент **"Обрезать"** к каждому из слоев (см. @task-task_cut).

::: {#task-task .callout-tip}
## Задание
Используйте инструмент **"Обрезать"** для обрезки всех слоев по границе Красноярского края. Сохраните все новые слои в файл "osm_krai.gpkg".
:::


## Кейс 1 Вычисление протяженности автомобильных дорог по муниципальным районам

Задача: Рассчитать протяженность крупных дорог (в слое "roads", в поле "fclass" это значения 'trunk', 'primary' и 'secondary') по муниципальным районам Красноярского края. В результате должна быть получена таблица с суммарной длиной дорог на территории каждого района.

!!! Фото результата.



Исходные данные: слои "roads" и "level_6".

Этапы выполнения:

- из слоя "roads" выбрать нужные типы дорог (в поле "fclass" значения 'trunk', 'primary' и 'secondary');
- используйте инструмент "Пересечение", что бы обрезать дороги по границам муниципальных районов и добавить в атрибуты название муниц. района;
- у каждой дороги рассчитать длину (в километрах);
- используйте инструмент "Агрегировать" для того, что бы рассчитать суммарную протяженность дорог для каждого района;
- создайте карту с окраской районов по протяженности дорог.

Описание:

Сначала следует рассмотреть структуру исходных слоев:

- слой "level_6" содержит полигоны, границы муниципальных районов Красноярского края. В таблице атрибутов содержится название для каждого района (поле "local_name");
- слой "roads" содержит линейные объекты, дороги. В атрибутах слоя указаны характеристики дорог, в том числе в поле "fclass" указан тип дороги ([подробнее о типах дорог в OSM](https://wiki.openstreetmap.org/wiki/Key:highway)). Согласно заданию, из всех дорог необходимо выбрать дороги с типами 'trunk', 'primary' и 'secondary'.

Для последующего подсчета длины нужно разбить дороги на части по границам муниципальных районов и добавить поле принадлежности к тому или иному району (инструмент "Пересечение").

После чего в слой дорог добавляют еще одно поле в котором рассчитывают длину каждой части дороги. На последнем этапе суммирую протяженность дорог для каждого муниципального района (инструмент "Агрегировать"). При этом геометрии дорог так же будут объединены в приделах района.


## Кейс 2 Определить все ЖД мосты (пересечения ЖД с реками)

Задача: Рассчитать количество железнодорожных мостов в каждом административном районе. Создать карту.

Исходные данные: слои "railways", "waterways" и "level_6".

Этапы выполнения:

- Выбрать из слоя "waterways" крупные реки (в поле "fclass" значение "river");
- Получить точечный слой пересечений крупных рек и железных дорог (инструмент "Пересечения линий");
- Построить буферы радиусом 30 м с объединением пересекающихся буферов (перед этим нужно; перепроецировать слой в систему координат ESRI: 102025);
- Извлечь центроиды из буферов (инструмент "Центроиды", чек-бокс "Создать центроиды для каждой части");
- Рассчитать количество мостов в каждом административном районе (инструмент "Подсчет точек в полигоне").
- Составить карту количества ЖД мостов по регионам (стиль "Символизация по диапазонам значений").

Описание:

Исходными данным для выполнения задания являются слои административных районов ("level_6"), слой железных дорог ("railways") и линейный слой рек ("waterways"). 





## Кейс 3 Определить процент площади муниц. района, покрытый водной поверхностью.


